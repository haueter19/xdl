<!DOCTYPE html>
    <head>
	    <meta charset="UTF-8">
        <meta name="author" content="Daniel Haueter">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
        <title>Draft Room</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="{{ url_for('static', path='/style.css') }}" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script>
            var data = {{ json|safe }};
            var owners = {{ owners_json|safe }};
            var owner_list = {{ owner_list|safe }};
            var paid_hist_data = {{ paid_histogram_data|safe }};
            var roster = {{ roster_json|safe}};
            var redirectStatus = '{{ status }}';
        </script>
        <script src="/static/js_functions.js"></script>
        <script src="/static/sort-table.js"></script>
    </head>
    <body>
        <!-- ===== Top Row: Search / Sims / Radar / Stats ===== -->
        <div class="draft-top-row">
            <div class="row g-3 px-3">
                <!-- Player Search -->
                <div class="col-md-3">
                    <div class="draft-card">
                        <div class="draft-card-header">Player Search</div>
                        <form action="/draft/update_bid" onsubmit="return validateForm()" id="bid_form" method="get" class="bid-form">
                            <input id="player_select" class="form-control form-control-sm mb-2" list="player_list" name="cbsid" placeholder="Search player...">
                            <datalist id="player_list">
                                {% for i, row in players.iterrows() %}
                                    <option value="{{ row['cbsid'] }}">{{ row['Name'] }}</option>
                                {% endfor %}
                            </datalist>
                            <div class="team-radio-grid" id="team_input"></div>
                            <div class="row mt-2">
                                <div class="col">
                                    <label for="price" class="form-label mb-0" style="font-size:11px;">Price</label>
                                    <input type="text" name="price" id="price_entry" class="form-control form-control-sm" placeholder="$" value=0 style="width:50px;display:inline-block;">
                                    <button type="submit" class="btn btn-sm btn-primary" id="submit">Bid</button>
                                </div>
                                <div class="col">
                                    <label for="supp" class="form-label mb-0" style="font-size:11px;">Supp</label>
                                    <input type="text" name="supp" id="supp_entry" class="form-control form-control-sm" placeholder="#" value="0" style="width:50px;display:inline-block;">
                                    <button type="submit" class="btn btn-sm btn-warning" id="supp_submit">Supp</button>
                                </div>
                            </div>
                            <div class="row mt-2 align-items-center">
                                <div class="col-8">
                                    <button type="button" class="btn btn-sm btn-success" id="acceptAuctionBid">Accept Bid</button>
                                </div>
                                <div class="col-4 text-end">
                                    <a class="reset-link" href="/draft/reset_all">Reset</a>
                                </div>
                            </div>
                        </form>
                        <div class="text-danger" id="error_msg" style="display:none;"></div>
                    </div>
                </div>
                <!-- Similar Players -->
                <div class="col-md-1">
                    <div class="draft-card">
                        <div class="draft-card-header">Similar Players</div>
                        <div id="sims"></div>
                        <div id="bidWinner" class="mt-2"></div>
                    </div>
                </div>
                <!-- Radar Chart -->
                <div class="col-md-1">
                    <div class="draft-card">
                        <div class="draft-card-header" id="radar_chart_player_name">Radar Chart</div>
                        <div id="radar_chart"></div>
                    </div>
                </div> 
                <!-- Player Stats -->
                <div class="col-md-7">
                    <div class="draft-card">
                        <div class="draft-card-header">Player Detail</div>
                        <div id="player_stats_window"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Main Content Row ===== -->
        <div class="row g-3 p-3">
            <!-- Draft Order Sidebar -->
            <div class="col-md-2">
                <div class="draft-card">
                    <div class="draft-card-header">Draft Order</div>
                    <div class="draft-scroll-pane">
                        <table class="draft-order-table" id="drafted_scroll">
                            {% for i, row in owned.sort_values('Timestamp', ascending=False).iterrows() %}
                            <tr>
                                <td>{{ row['Name'] }}</td>
                                <td>${{ row['Paid'] }}</td>
                                <td class="text-muted-custom">{{ row['Owner'] }}</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
            <!-- Cash Meter Sidebar -->
            <div class="col-md-1">
                <div class="draft-card">
                    <div class="draft-card-header">Cash Meter</div>
                    <table class="cash-meter-table">
                        <tr>
                            <th>Team</th>
                            <th>Cash+</th>
                        </tr>
                        {% for i, row in owners_df.iterrows() %}
                        <tr>
                            <td{% if row['Owner'] == 'Lima Time' %} class="my-team"{% endif %}>{{ row['Owner'] }}</td>
                            <td id="{{ row['Owner']|replace(' ','_') }}_meter">{{ row['Cash'] }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                    <div class="mt-3">
                        <div class="stat-badge">
                            <span class="stat-label">Inflation</span>
                            <span class="inflation-value">{{ inflation_factor }}</span>
                        </div>
                        <div class="stat-badge">
                            <span class="stat-label">Players Left</span>
                            <span class="stat-value">{{ players_left }}</span>
                        </div>
                        <div class="stat-badge">
                            <span class="stat-label">$ Left</span>
                            <span class="stat-value">{{ dollars_left }}</span>
                        </div>
                        <div class="stat-badge">
                            <span class="stat-label">Init $/z</span>
                            <span class="stat-value">{{ init_dollars_per_z }}</span>
                        </div>
                        <div class="stat-badge">
                            <span class="stat-label">Curr $/z</span>
                            <span class="stat-value">{{ current_dollars_per_z }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Main Tabbed Content -->
            <div class="col-md-9">
                <div class="draft-card" style="padding:8px 14px;">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="tab" href="#summary">Summary</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#rosters">Rosters</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#charts">Charts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#tiers">Tiers</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#players">Players</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#paid_hist">Paid $ Hist</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#team_z">Total Z</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#surplus">Surplus</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#stat_tiers">Stat Tiers</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <!-- Summary Tab -->
                        <div class="tab-pane fade" id="summary">
                            <table class="table draft-table table-hover" id="myTable">
                                <thead>
                                    <th onclick="sortTable(0, 'myTable')">Owner</th>
                                    <th onclick="sortTable(1, 'myTable')">Cash Sitch</th>
                                    <th onclick="sortTable(2, 'myTable')">$ Left</th>
                                    <th onclick="sortTable(3, 'myTable')">Max Bid</th>
                                    <th onclick="sortTable(4, 'myTable')">$ Left/Plyr</th>
                                    <th onclick="sortTable(5, 'myTable')">Drafted</th>
                                    <th onclick="sortTable(6, 'myTable')">Value+/-</th>
                                    <th onclick="sortTable(7, 'myTable')">Pts</th>
                                    <th onclick="sortTable(8, 'myTable')">Rank</th>
                                    <th onclick="sortTable(9, 'myTable')">$/Unit</th>
                                    <th onclick="sortTable(10, 'myTable')">BA</th>
                                    <th onclick="sortTable(11, 'myTable')">HR</th>
                                    <th onclick="sortTable(12, 'myTable')">R</th>
                                    <th onclick="sortTable(13, 'myTable')">RBI</th>
                                    <th onclick="sortTable(14, 'myTable')">SB</th>
                                    <th onclick="sortTable(15, 'myTable')">ERA</th>
                                    <th onclick="sortTable(16, 'myTable')">WHIP</th>
                                    <th onclick="sortTable(17, 'myTable')">QS</th>
                                    <th onclick="sortTable(18, 'myTable')">SO</th>
                                    <th onclick="sortTable(19, 'myTable')">SvHld</th>
                                </thead>
                            {% for i, row in owners_df.iterrows() %}
                                <tr id="summary_{{ row['Owner'] }}" {% if row['Owner'] == 'Lima Time' %}class="my-team-row"{% endif %}>
                                    <td>{{ row['Owner'] }}</td>
                                    <td>{{ row['Cash'] }}</td>
                                    <td>{{ row['$ Left'] }}</td>
                                    <td>{{ row['max_bid'] }}</td>
                                    <td>{{ row['$ Left / Plyr'] }}</td>
                                    <td>{{ row['Drafted'] }}</td>
                                    <td>{{ row['Value'] }}</td>
                                    <td>{{ row['Pts'] }}</td>
                                    <td>{{ row['Rank'] }}</td>
                                    <td>{{ row['$/unit'] }}</td>
                                    <td>{{ row['BA'] }}</td>
                                    <td>{{ row['HR'] }}</td>
                                    <td>{{ row['R'] }}</td>
                                    <td>{{ row['RBI'] }}</td>
                                    <td>{{ row['SB'] }}</td>
                                    <td>{{ row['ERA'] }}</td>
                                    <td>{{ row['WHIP'] }}</td>
                                    <td>{{ row['QS'] }}</td>
                                    <td>{{ row['SO'] }}</td>
                                    <td>{{ row['SvHld'] }}</td>
                                </tr>
                            {% endfor %}
                            </table>
                            <div class="avg-stats-row">
                                {% for key, value in avg_stats.items() %}
                                    <span class="avg-stat-chip"><span class="label">{{ key }}</span> <span class="val">{{ value }}</span></span>
                                {% endfor %}
                            </div>
                        </div>
                        <!-- Rosters Tab -->
                        <div class="tab-pane fade" id="rosters">
                            <table class="table roster-table table-hover" id="rosterTable">
                                <thead>
                                    <th>Pos</th>
                                    <th>9 Grand Kids</th>
                                    <th>Brewbirds</th>
                                    <th>Charmer</th>
                                    <th>Dirty Birds</th>
                                    <th>Harvey</th>
                                    <th class="col-my-team">Lima Time</th>
                                    <th>Mother</th>
                                    <th>Roid Ragers</th>
                                    <th>Trouble</th>
                                    <th>Ugly Spuds</th>
                                    <th>Wu-Tang</th>
                                    <th>Young Guns</th>
                                </thead>
                                {% for i, row in roster.iterrows() %}
                                    <tr>
                                        <td>{{ i }}</td>
                                        <td>{{ row['9 Grand Kids'] if row['9 Grand Kids'] != 0 else '' }}</td>
                                        <td>{{ row['Brewbirds'] if row['Brewbirds'] != 0 else '' }}</td>
                                        <td>{{ row['Charmer'] if row['Charmer'] != 0 else '' }}</td>
                                        <td>{{ row['Dirty Birds'] if row['Dirty Birds'] != 0 else '' }}</td>
                                        <td>{{ row['Harvey'] if row['Harvey'] != 0 else '' }}</td>
                                        <td class="col-my-team">{{ row['Lima Time'] if row['Lima Time'] != 0 else '' }}</td>
                                        <td>{{ row['Mother'] if row['Mother'] != 0 else '' }}</td>
                                        <td>{{ row['Roid Ragers'] if row['Roid Ragers'] != 0 else '' }}</td>
                                        <td>{{ row['Trouble'] if row['Trouble'] != 0 else '' }}</td>
                                        <td>{{ row['Ugly Spuds'] if row['Ugly Spuds'] != 0 else '' }}</td>
                                        <td>{{ row['Wu-Tang'] if row['Wu-Tang'] != 0 else '' }}</td>
                                        <td>{{ row['Young Guns'] if row['Young Guns'] != 0 else '' }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                        <!-- Charts Tab -->
                        <div class="tab-pane fade" id="charts">
                            <div class="chart-btn-group mt-2 mb-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" id="button-1">Pts</button>
                                <button type="button" class="btn btn-sm btn-outline-primary active" id="button-2">$ Left</button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="button-3">Total Z</button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="button-4">$/Unit</button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="button-5">Drafted</button>
                            </div>
                            <div id="owners_chart"></div>
                        </div>
                        <!-- Tiers Tab -->
                        <div class="tab-pane active" id="tiers">
                            <div id="tiers_chart"></div>
                        </div>
                        <!-- Players Tab -->
                        <div class="tab-pane fade" id="players">
                            <div id="z_players_chart"></div>
                        </div>
                        <!-- Paid Histogram Tab -->
                        <div class="tab-pane fade" id="paid_hist">
                            <div id="paid_hist_chart"></div>
                        </div>
                        <!-- Total Z Tab -->
                        <div class="tab-pane fade" id="team_z">
                            <table class="table draft-table table-hover" id="z_table">
                                <thead>
                                    <th onclick="sortTable(0, 'z_table')">Owner</th>
                                    <th onclick="sortTable(1, 'z_table')">HR</th>
                                    <th onclick="sortTable(2, 'z_table')">SB</th>
                                    <th onclick="sortTable(3, 'z_table')">R</th>
                                    <th onclick="sortTable(4, 'z_table')">RBI</th>
                                    <th onclick="sortTable(5, 'z_table')">BA</th>
                                    <th onclick="sortTable(6, 'z_table')">QS</th>
                                    <th onclick="sortTable(7, 'z_table')">K</th>
                                    <th onclick="sortTable(8, 'z_table')">SvHld</th>
                                    <th onclick="sortTable(9, 'z_table')">ERA</th>
                                    <th onclick="sortTable(10, 'z_table')">WHIP</th>
                                </thead>
                            {% for i, row in team_z.iterrows() %}
                            <tr id="z_table_{{ row['Owner'] }}" {% if row['Owner'] == 'Lima Time' %}class="my-team-row"{% endif %}>
                                <td>{{ row['Owner'] }}</td>
                                <td>{{ row['zHR'] }}</td>
                                <td>{{ row['zSB'] }}</td>
                                <td>{{ row['zR'] }}</td>
                                <td>{{ row['zRBI'] }}</td>
                                <td>{{ row['zBA'] }}</td>
                                <td>{{ row['zQS'] }}</td>
                                <td>{{ row['zSO'] }}</td>
                                <td>{{ row['zSvHld'] }}</td>
                                <td>{{ row['zERA'] }}</td>
                                <td>{{ row['zWHIP'] }}</td>
                            </tr>
                            {% endfor %}
                            </table>
                        </div>
                        <!-- Surplus Tab -->
                        <div class="tab-pane fade" id="surplus">
                            <table class="table draft-table table-hover" id="surplus_tbl">
                                <thead>
                                    <th>Player</th>
                                    <th>Team</th>
                                    <th>Pos</th>
                                    <th>Surplus</th>
                                    <th>Market</th>
                                    <th>Value</th>
                                    <th>CBS</th>
                                    <th>FG Value</th>
                                    <th>BA</th>
                                    <th>HR</th>
                                    <th>SB</th>
                                    <th>R</th>
                                    <th>RBI</th>
                                    <th>ERA</th>
                                    <th>WHIP</th>
                                    <th>K</th>
                                    <th>QS</th>
                                    <th>SvHld</th>
                                </thead>
                            {% for i, row in players[(players['Owner'].isna())].sort_values('surplus', ascending=False).iterrows() %}
                            <tr>
                                <td>{{ row['Name'] }}</td>
                                <td>{{ row['Team'] }}</td>
                                <td>{{ row['Pos'] }}</td>
                                <td><strong>{{ row['surplus'] }}</strong></td>
                                <td>{{ row['curValue'] }}</td>
                                <td>{{ row['Value'] }}</td>
                                <td>{{ row['CBS'] }}</td>
                                <td>{{ row['Dollars'] }}</td>
                                <td>{{ row['BA'] }}</td>
                                <td>{{ row['HR'] }}</td>
                                <td>{{ row['SB'] }}</td>
                                <td>{{ row['R'] }}</td>
                                <td>{{ row['RBI'] }}</td>
                                <td>{{ row['ERA'] }}</td>
                                <td>{{ row['WHIP'] }}</td>
                                <td>{{ row['SO'] }}</td>
                                <td>{{ row['QS'] }}</td>
                                <td>{{ row['SvHld'] }}</td>
                            </tr>
                            {% endfor %}
                            </table>
                        </div>
                        <!-- Stat Tiers Tab -->
                        <div class="tab-pane fade" id="stat_tiers">
                            <table class="table draft-table table-hover" id="stat_tiers_tbl">
                                <thead>
                                    <th>Player</th>
                                    <th>Team</th>
                                    <th>Pos</th>
                                    <th onclick="sortTable(3, 'stat_tiers_tbl')">Surplus</th>
                                    <th onclick="sortTable(4, 'stat_tiers_tbl')">Market</th>
                                    <th onclick="sortTable(5, 'stat_tiers_tbl')">Value</th>
                                    <th onclick="sortTable(6, 'stat_tiers_tbl')">CBS</th>
                                    <th onclick="sortTable(7, 'stat_tiers_tbl')">BA</th>
                                    <th onclick="sortTable(8, 'stat_tiers_tbl')">HR</th>
                                    <th onclick="sortTable(9, 'stat_tiers_tbl')">SB</th>
                                    <th onclick="sortTable(10, 'stat_tiers_tbl')">R</th>
                                    <th onclick="sortTable(11, 'stat_tiers_tbl')">RBI</th>
                                    <th onclick="sortTable(12, 'stat_tiers_tbl')">ERA</th>
                                    <th onclick="sortTable(13, 'stat_tiers_tbl')">WHIP</th>
                                    <th onclick="sortTable(14, 'stat_tiers_tbl')">K</th>
                                    <th onclick="sortTable(15, 'stat_tiers_tbl')">QS</th>
                                    <th onclick="sortTable(16, 'stat_tiers_tbl')">SvHld</th>
                                </thead>
                            {% for i, row in players[players['Owner'].isna()].sort_values('z', ascending=False).iloc[:440].iterrows() %}
                            <tr>
                                <td>{{ row['Name'] }}</td>
                                <td>{{ row['Team'] }}</td>
                                <td>{{ row['Pos'] }}</td>
                                <td><strong>{{ row['surplus'] }}</strong></td>
                                <td>{{ row['curValue'] }}</td>
                                <td>{{ row['Value'] }}</td>
                                <td>{{ row['CBS'] }}</td>
                                <td>{{ row['BA'] }}</td>
                                <td>{{ row['HR'] }}</td>
                                <td>{{ row['SB'] }}</td>
                                <td>{{ row['R'] }}</td>
                                <td>{{ row['RBI'] }}</td>
                                <td>{{ row['ERA'] }}</td>
                                <td>{{ row['WHIP'] }}</td>
                                <td>{{ row['SO'] }}</td>
                                <td>{{ row['QS'] }}</td>
                                <td>{{ row['SvHld'] }}</td>
                            </tr>
                            {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
